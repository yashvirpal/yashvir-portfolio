<div class="px-5 py-5 md:px-10 md:pt-10 ">
    <div class="text-silver text-justify">
        <div class="flex gap-3 items-center">
            <h2 class="text-white font-bold text-3xl font-roboto-slab">Contact</h2>
            <span class="bg-blue w-[80px] h-[2px]"></span>
        </div>
    </div>
</div>
<div class="px-5 py-5 md:px-10 bg-gray text-silver  mx-5 rounded-2xl">
    <p>I'm always open to discussing product</p>
    <h6 class="text-white my-4 font-bold">design & development work or partnerships.</h6>
    <form id="myForm" action="/send-mail" method="POST">
        <div class="focus:[&>*]:border-blue focus:[&>label]:text-blue my-6">
            <label class="block ">Name * </label>
            <input id="name" name="name" type="text" class="bg-transparent border-b w-full outline-none focus:h-8" />
        </div>
        <div class="focus:[&>*]:border-blue focus:[&>label]:text-blue my-6">
            <label class="block ">Email * </label>
            <input id="email" name="email" type="email" class="bg-transparent border-b w-full outline-none focus:h-8" />
        </div>
        <div class="focus:[&>*]:border-blue focus:[&>label]:text-blue my-6">
            <label class="block ">Phone * </label>
            <input id="phone" name="phone" type="text" class="bg-transparent border-b w-full outline-none focus:h-8" />
        </div>
        <div class="focus:[&>*]:border-blue focus:[&>label]:text-blue my-6">
            <label class="block ">Message * </label>
            <input id="message" name="message" type="text"
                class="bg-transparent border-b w-full outline-none focus:h-8" />
        </div>
        <!-- Hidden input to store the reCAPTCHA token -->
        <input type="hidden" name="recaptchaToken" id="recaptchaToken">
        <button class="rounded-lg text-white block border border-silver px-3 py-1 hover:border-blue">Submit</button>
        <br />
        <span id="error_message" class="message mt-10 text-pdtlphonecolor"></span>



    </form>

</div>

<script src="https://www.google.com/recaptcha/api.js?render=<%= recaptchaSiteKey %>"></script>

<script>
    const SITE_KEY = '<%= recaptchaSiteKey %>';

    document.getElementById('myForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const form = e.target;
        document.getElementById('error_message').innerText = "";

        // Get reCAPTCHA token first
        grecaptcha.ready(async function () {
            const token = await grecaptcha.execute(SITE_KEY, { action: 'submit' });

            // Append token to form data
            const formData = new FormData(form);
            formData.append('recaptchaToken', token);

            // Send form data using fetch
            const res = await fetch(form.action, {
                method: 'POST',
                body: new URLSearchParams(formData)
            });

            const text = await res.text();

            if (!res.ok) {
                document.getElementById('error_message').innerText = text;
            } else {
                window.location.href = '/thankyou';
            }
        });
    });
</script>